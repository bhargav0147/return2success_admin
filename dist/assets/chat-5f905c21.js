import{cg as q,r as c,cW as Oe,ch as A,q as x,f as H,a as E,p as F,j as e,E as L,A as k,a0 as $,S as p,T as w,e as T,dy as P,cb as Le,cc as $e,bj as Ne,I as g,d as h,D as De,J as V,c$ as Fe,g as te,ai as z,$ as oe,cE as Pe,cJ as Me,cu as Ue,d_ as Ee,am as ze,k as R,c as J,bT as ne,d$ as Ge,e0 as We,bO as Ve,v as _e,b as Be,C as qe,o as He,W as Je}from"./index-27ffd735.js";import{k as Ke,f as re}from"./keyBy-5baa73fc.js";import{u as K,m as U}from"./index-b6b89eba.js";import{A as ae}from"./AvatarGroup-4ff0f142.js";import{L as M}from"./ListItemText-ff35796a.js";import{S as Ye}from"./Select-7c65bb90.js";import{b as ie}from"./InputBase-894de89e.js";import{S as _}from"./Skeleton-f774d223.js";import{S as le}from"./search-not-found-e6059c5f.js";import{T as ce}from"./TextField-18c86d14.js";import{I as Qe}from"./InputAdornment-babdc070.js";import{C as Xe}from"./ClickAwayListener-2f801b48.js";import{D as Ze}from"./Dialog-5a3d7487.js";import{D as es}from"./DialogContent-90bef667.js";import{b as ss,c as ts}from"./format-time-4dc4f2eb.js";import{F as os}from"./file-thumbnail-bdf7cfb6.js";import{u as ns,L as rs}from"./use-light-box-5fb5e135.js";import{u as X}from"./uuidv4-bea31cbe.js";import{A as as}from"./Autocomplete-b5c308cf.js";import{C as is}from"./Chip-a5be7a74.js";import"./_baseEach-4159b158.js";import"./_baseIteratee-9e852688.js";import"./_baseToString-c85d59f0.js";import"./index-e5978b8b.js";import"./Menu-02e5c653.js";import"./List-1e1da31b.js";import"./utils-a73c94d0.js";import"./formControlState-a1fb9590.js";import"./useFormControl-146f88ba.js";import"./FormControl-26894946.js";import"./FormLabel-fae9cf0f.js";import"./dialogTitleClasses-80e3b880.js";import"./Close-d91a1546.js";const Y={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function ls(){const t=[A.chat,{params:{endpoint:"contacts"}}],{data:r,isLoading:o,error:a,isValidating:n}=K(t,q,Y);return c.useMemo(()=>({contacts:(r==null?void 0:r.contacts)||[],contactsLoading:o,contactsError:a,contactsValidating:n,contactsEmpty:!o&&!(r!=null&&r.contacts.length)}),[r==null?void 0:r.contacts,a,o,n])}function cs(){const t=[A.chat,{params:{endpoint:"conversations"}}],{data:r,isLoading:o,error:a,isValidating:n}=K(t,q,Y);return c.useMemo(()=>{const i=Ke(r==null?void 0:r.conversations,"id")||{},l=Object.keys(i)||[];return{conversations:{byId:i,allIds:l},conversationsLoading:o,conversationsError:a,conversationsValidating:n,conversationsEmpty:!o&&!l.length}},[r==null?void 0:r.conversations,a,o,n])}function ds(t){const r=t?[A.chat,{params:{conversationId:t,endpoint:"conversation"}}]:"",{data:o,isLoading:a,error:n,isValidating:s}=K(r,q,Y);return c.useMemo(()=>({conversation:o==null?void 0:o.conversation,conversationLoading:a,conversationError:n,conversationValidating:s}),[o==null?void 0:o.conversation,n,a,s])}async function hs(t,r){const o=[A.chat,{params:{endpoint:"conversations"}}],a=[A.chat,{params:{conversationId:t,endpoint:"conversation"}}];U(a,n=>{const{conversation:s}=n;return{conversation:{...s,messages:[...s.messages,r]}}},!1),U(o,n=>{const{conversations:s}=n;return{conversations:s.map(l=>l.id===t?{...l,messages:[...l.messages,r]}:l)}},!1)}async function ps(t){const r=[A.chat,{params:{endpoint:"conversations"}}],o={conversationData:t},a=await Oe.post(A.chat,o);return U(r,n=>{const s=[...n.conversations,t];return{...n,conversations:s}},!1),a.data}async function xs(t){const r=A.chat;U([r,{params:{endpoint:"conversations"}}],o=>{const a=o.conversations.map(n=>n.id===t?{...n,unreadCount:0}:n);return{...o,conversations:a}},!1)}function us({message:t,participants:r,currentUserId:o}){const a=r.find(l=>l.id===t.senderId),n=t.senderId===o?{type:"me"}:{avatarUrl:a==null?void 0:a.avatarUrl,firstName:a==null?void 0:a.name.split(" ")[0]},s=n.type==="me";return{hasImage:t.contentType==="image",me:s,senderDetails:n}}function ms({currentUserId:t,conversation:r}){const{messages:o,participants:a}=r,n=a.filter(u=>u.id!==t),s=o[o.length-1],i=n.length>1,l=n.map(u=>u.name).join(", "),m=i?n.map(u=>u.status).includes("online"):!1;let d="";if(s){const u=s.senderId===t?"You: ":"",b=s.contentType==="image"?"Sent a photo":s.body;d=`${u}${b}`}return{group:i,displayName:l,displayText:d,participants:n,lastActivity:s.createdAt,hasOnlineInGroup:m}}function de(){const[t,r]=c.useState(!1),[o,a]=c.useState(!1),n=c.useCallback(()=>{a(m=>!m)},[]),s=c.useCallback(()=>{a(!1)},[]),i=c.useCallback(()=>{r(!0)},[]),l=c.useCallback(()=>{r(!1)},[]);return{openMobile:t,collapseDesktop:o,onOpenMobile:i,onCloseMobile:l,onCloseDesktop:s,onCollapseDesktop:n}}function gs(t){const r=c.useRef(null),o=c.useCallback(()=>{t&&r.current&&r.current&&(r.current.scrollTop=r.current.scrollHeight)},[t]);return c.useEffect(()=>{o()},[t]),{messagesEndRef:r}}function he({selected:t,collapse:r,conversation:o,onCloseMobile:a}){const{user:n}=P(),s=H("up","md"),i=E(),{group:l,displayName:m,displayText:d,participants:u,lastActivity:b,hasOnlineInGroup:f}=ms({conversation:o,currentUserId:`${n==null?void 0:n.id}`}),j=u[0],{name:y,avatarUrl:v,status:I}=j,N=c.useCallback(async()=>{try{s||a(),await xs(o.id),i.push(`${F.dashboard.chat}?id=${o.id}`)}catch(O){console.error(O)}},[o.id,s,a,i]),S=e.jsx(L,{variant:f?"online":"invisible",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ae,{variant:"compact",sx:{width:48,height:48},children:u.slice(0,2).map(O=>e.jsx(k,{alt:O.name,src:O.avatarUrl},O.id))})}),G=e.jsx(L,{variant:I,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(k,{alt:y,src:v,sx:{width:48,height:48}})},I);return e.jsxs($,{disableGutters:!0,onClick:N,sx:{py:1.5,px:2.5,...t&&{bgcolor:"action.selected"}},children:[e.jsx(L,{color:"error",overlap:"circular",badgeContent:r?o.unreadCount:0,children:l?S:G}),!r&&e.jsxs(e.Fragment,{children:[e.jsx(M,{sx:{ml:2},primary:m,primaryTypographyProps:{noWrap:!0,variant:"subtitle2"},secondary:d,secondaryTypographyProps:{noWrap:!0,component:"span",variant:o.unreadCount?"subtitle2":"body2",color:o.unreadCount?"text.primary":"text.secondary"}}),e.jsxs(p,{alignItems:"flex-end",sx:{ml:2,height:44},children:[e.jsx(w,{noWrap:!0,variant:"body2",component:"span",sx:{mb:1.5,fontSize:12,color:"text.disabled"},children:re(new Date(b),{addSuffix:!1})}),!!o.unreadCount&&e.jsx(T,{sx:{width:8,height:8,bgcolor:"info.main",borderRadius:"50%"}})]})]})]})}he.propTypes={collapse:x.bool,conversation:x.object,onCloseMobile:x.func,selected:x.bool};function fs(){const{user:t}=P(),r=Le(),[o,a]=c.useState("online"),n=c.useCallback(s=>{a(s.target.value)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:o,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(k,{src:t==null?void 0:t.photoURL,alt:t==null?void 0:t.displayName,onClick:r.onOpen,sx:{cursor:"pointer",width:48,height:48}})}),e.jsxs($e,{open:r.open,onClose:r.onClose,arrow:"top-left",sx:{p:0},children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:2,sx:{py:2,pr:1,pl:2.5},children:[e.jsx(M,{primary:t==null?void 0:t.displayName,secondary:t==null?void 0:t.email,secondaryTypographyProps:{component:"span"}}),e.jsx(Ne,{title:"Log out",children:e.jsx(g,{color:"error",children:e.jsx(h,{icon:"ic:round-power-settings-new"})})})]}),e.jsx(De,{sx:{borderStyle:"dashed"}}),e.jsxs(p,{sx:{p:1},children:[e.jsxs(V,{children:[e.jsx(L,{variant:o,sx:{[`& .${Fe.badge}`]:{position:"static",m:.75,width:12,height:12,flexShrink:0}}}),e.jsx(Ye,{native:!0,fullWidth:!0,value:o,onChange:n,input:e.jsx(ie,{sx:{pl:2}}),inputProps:{sx:{textTransform:"capitalize"}},children:["online","alway","busy","offline"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs(V,{children:[e.jsx(h,{icon:"solar:user-id-bold",width:24}),"Profile"]}),e.jsxs(V,{children:[e.jsx(h,{icon:"eva:settings-2-fill",width:24}),"Settings"]})]})]})]})}function pe({sx:t,...r}){return e.jsxs(p,{spacing:2,direction:"row",alignItems:"center",sx:{px:2.5,py:1.5,...t},...r,children:[e.jsx(_,{variant:"circular",sx:{width:48,height:48}}),e.jsxs(p,{spacing:1,flexGrow:1,children:[e.jsx(_,{sx:{width:.75,height:10}}),e.jsx(_,{sx:{width:.5,height:10}})]})]})}pe.propTypes={sx:x.object};function xe({query:t,results:r,onClickResult:o}){const a=r.length,n=!a&&!!t;return e.jsxs(e.Fragment,{children:[e.jsxs(w,{variant:"h6",sx:{px:2.5,mb:2},children:["Contacts (",a,")"]}),n?e.jsx(le,{query:t,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}):e.jsx(e.Fragment,{children:r.map(s=>e.jsxs($,{onClick:()=>o(s),sx:{px:2.5,py:1.5,typography:"subtitle2"},children:[e.jsx(k,{alt:s.name,src:s.avatarUrl,sx:{mr:2}}),s.name]},s.id))})]})}xe.propTypes={query:x.string,results:x.array,onClickResult:x.func};const Z=320,js=96;function ue({loading:t,contacts:r,conversations:o,selectedConversationId:a}){const n=te(),s=E(),i=H("up","md"),{collapseDesktop:l,onCloseDesktop:m,onCollapseDesktop:d,openMobile:u,onOpenMobile:b,onCloseMobile:f}=de(),[j,y]=c.useState({query:"",results:[]});c.useEffect(()=>{i||m()},[m,i]);const v=c.useCallback(()=>{i?d():f()},[i,f,d]),I=c.useCallback(()=>{i||f(),s.push(F.dashboard.chat)},[i,f,s]),N=c.useCallback(C=>{if(y(D=>({...D,query:C})),C){const D=r.filter(W=>W.name.toLowerCase().includes(C));y(W=>({...W,results:D}))}},[r]),S=c.useCallback(()=>{y({query:"",results:[]})},[]),G=c.useCallback(C=>{S(),s.push(`${F.dashboard.chat}?id=${C.id}`)},[S,s]),O=e.jsx(g,{onClick:b,sx:{left:0,top:84,zIndex:9,width:32,height:32,position:"absolute",borderRadius:"0 12px 12px 0",bgcolor:n.palette.primary.main,boxShadow:n.customShadows.primary,color:n.palette.primary.contrastText,"&:hover":{bgcolor:n.palette.primary.darker}},children:e.jsx(h,{width:16,icon:"solar:users-group-rounded-bold"})}),Te=e.jsx(e.Fragment,{children:[...Array(12)].map((C,D)=>e.jsx(pe,{},D))}),Ie=e.jsx(e.Fragment,{children:o.allIds.map(C=>e.jsx(he,{collapse:l,conversation:o.byId[C],selected:C===a,onCloseMobile:f},C))}),Re=e.jsx(xe,{query:j.query,results:j.results,onClickResult:G}),Ae=e.jsx(Xe,{onClickAway:S,children:e.jsx(ce,{fullWidth:!0,value:j.query,onChange:C=>N(C.target.value),placeholder:"Search contacts...",InputProps:{startAdornment:e.jsx(Qe,{position:"start",children:e.jsx(h,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{mt:2.5}})}),Q=e.jsxs(e.Fragment,{children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"center",sx:{p:2.5,pb:0},children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(fs,{}),e.jsx(T,{sx:{flexGrow:1}})]}),e.jsx(g,{onClick:v,children:e.jsx(h,{icon:l?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),!l&&e.jsx(g,{onClick:I,children:e.jsx(h,{width:24,icon:"solar:user-plus-bold"})})]}),e.jsx(T,{sx:{p:2.5,pt:0},children:!l&&Ae}),e.jsxs(z,{sx:{pb:1},children:[j.query&&Re,t&&Te,!j.query&&!!o.allIds.length&&Ie]})]});return e.jsxs(e.Fragment,{children:[!i&&O,i?e.jsx(p,{sx:{height:1,flexShrink:0,width:Z,borderRight:`solid 1px ${n.palette.divider}`,transition:n.transitions.create(["width"],{duration:n.transitions.duration.shorter}),...l&&{width:js}},children:Q}):e.jsx(oe,{open:u,onClose:f,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:Z}},children:Q})]})}ue.propTypes={contacts:x.array,conversations:x.object,loading:x.bool,selectedConversationId:x.string};var ee=Pe,bs=Me,ys=Ue,se=ee?ee.isConcatSpreadable:void 0;function vs(t){return ys(t)||bs(t)||!!(se&&t&&t[se])}var Cs=vs,ws=Ee,ks=Cs;function me(t,r,o,a,n){var s=-1,i=t.length;for(o||(o=ks),n||(n=[]);++s<i;){var l=t[s];r>0&&o(l)?r>1?me(l,r-1,o,a,n):ws(n,l):a||(n[n.length]=l)}return n}var Ss=me,Ts=Ss;function Is(t){var r=t==null?0:t.length;return r?Ts(t,1):[]}var Rs=Is;const As=ze(Rs);function ge({participant:t,open:r,onClose:o}){return e.jsxs(Ze,{fullWidth:!0,maxWidth:"xs",open:r,onClose:o,children:[e.jsx(g,{onClick:o,sx:{position:"absolute",right:8,top:8},children:e.jsx(h,{icon:"mingcute:close-line"})}),e.jsxs(es,{sx:{py:5,px:3,display:"flex"},children:[e.jsx(k,{alt:t.name,src:t.avatarUrl,sx:{width:96,height:96,mr:3}}),e.jsxs(p,{spacing:1,children:[e.jsx(w,{variant:"caption",sx:{color:"primary.main"},children:t.role}),e.jsx(w,{variant:"subtitle1",children:t.name}),e.jsxs(p,{direction:"row",sx:{typography:"caption",color:"text.disabled"},children:[e.jsx(h,{icon:"mingcute:location-fill",width:16,sx:{flexShrink:0,mr:.5,mt:"2px"}}),t.address]}),e.jsxs(p,{spacing:1,direction:"row",sx:{pt:1.5},children:[e.jsx(g,{size:"small",color:"error",sx:{borderRadius:1,bgcolor:a=>R(a.palette.error.main,.08),"&:hover":{bgcolor:a=>R(a.palette.error.main,.16)}},children:e.jsx(h,{width:18,icon:"solar:phone-bold"})}),e.jsx(g,{size:"small",color:"info",sx:{borderRadius:1,bgcolor:a=>R(a.palette.info.main,.08),"&:hover":{bgcolor:a=>R(a.palette.info.main,.16)}},children:e.jsx(h,{width:18,icon:"solar:chat-round-dots-bold"})}),e.jsx(g,{size:"small",color:"primary",sx:{borderRadius:1,bgcolor:a=>R(a.palette.primary.main,.08),"&:hover":{bgcolor:a=>R(a.palette.primary.main,.16)}},children:e.jsx(h,{width:18,icon:"fluent:mail-24-filled"})}),e.jsx(g,{size:"small",color:"secondary",sx:{borderRadius:1,bgcolor:a=>R(a.palette.secondary.main,.08),"&:hover":{bgcolor:a=>R(a.palette.secondary.main,.16)}},children:e.jsx(h,{width:18,icon:"solar:videocamera-record-bold"})})]})]})]})]})}ge.propTypes={onClose:x.func,open:x.bool,participant:x.object};function fe({participants:t}){const[r,o]=c.useState(null),a=J(!0),n=c.useCallback(d=>{o(d)},[]),s=()=>{o(null)},i=t.length,l=e.jsxs($,{onClick:a.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsxs(T,{component:"span",sx:{flexGrow:1},children:["In room (",i,")"]}),e.jsx(h,{width:16,icon:a.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),m=e.jsx(z,{sx:{height:56*4},children:t.map(d=>e.jsxs($,{onClick:()=>n(d),children:[e.jsx(L,{variant:d.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(k,{alt:d.name,src:d.avatarUrl})}),e.jsx(M,{sx:{ml:2},primary:d.name,secondary:d.role,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{noWrap:!0,component:"span",typography:"caption"}})]},d.id))});return e.jsxs(e.Fragment,{children:[l,e.jsx("div",{children:e.jsx(ne,{in:a.value,children:m})}),r&&e.jsx(ge,{participant:r,open:!!r,onClose:s})]})}fe.propTypes={participants:x.array};function je({participant:t}){const r=J(!0),{name:o,avatarUrl:a,role:n,address:s,phoneNumber:i,email:l}=t,m=e.jsxs(p,{alignItems:"center",sx:{py:5},children:[e.jsx(k,{alt:o,src:a,sx:{width:96,height:96,mb:2}}),e.jsx(w,{variant:"subtitle1",children:o}),e.jsx(w,{variant:"body2",sx:{color:"text.secondary",mt:.5},children:n})]}),d=e.jsxs($,{onClick:r.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsx(T,{component:"span",sx:{flexGrow:1},children:"Information"}),e.jsx(h,{width:16,icon:r.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),u=e.jsxs(p,{spacing:2,sx:{px:2,py:2.5,"& svg":{mr:1,flexShrink:0,color:"text.disabled"}},children:[e.jsxs(p,{direction:"row",children:[e.jsx(h,{icon:"mingcute:location-fill"}),e.jsx(w,{variant:"body2",children:s})]}),e.jsxs(p,{direction:"row",children:[e.jsx(h,{icon:"solar:phone-bold"}),e.jsx(w,{variant:"body2",children:i})]}),e.jsxs(p,{direction:"row",children:[e.jsx(h,{icon:"fluent:mail-24-filled"}),e.jsx(w,{variant:"body2",noWrap:!0,children:l})]})]});return e.jsxs(e.Fragment,{children:[m,d,e.jsx("div",{children:e.jsx(ne,{in:r.value,children:u})})]})}je.propTypes={participant:x.object};function be({attachments:t}){const r=J(!0),o=t.length,a=e.jsxs($,{disabled:!t.length,onClick:r.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsxs(T,{component:"span",sx:{flexGrow:1},children:["Attachments (",o,")"]}),e.jsx(h,{width:16,icon:!r.value&&"eva:arrow-ios-forward-fill"||!t.length&&"eva:arrow-ios-forward-fill"||"eva:arrow-ios-downward-fill"})]}),n=e.jsx(z,{sx:{px:2,py:2.5},children:t.map((s,i)=>e.jsxs(p,{spacing:1.5,direction:"row",alignItems:"center",sx:{mb:2},children:[e.jsx(p,{alignItems:"center",justifyContent:"center",sx:{width:40,height:40,flexShrink:0,borderRadius:1,overflow:"hidden",position:"relative",backgroundColor:"background.neutral"},children:e.jsx(os,{imageView:!0,file:s.preview,onDownload:()=>console.info("DOWNLOAD"),sx:{width:28,height:28}})}),e.jsx(M,{primary:s.name,secondary:ss(s.createdAt),primaryTypographyProps:{noWrap:!0,typography:"body2"},secondaryTypographyProps:{mt:.25,noWrap:!0,component:"span",typography:"caption",color:"text.disabled"}})]},s.name+i))});return e.jsxs(e.Fragment,{children:[a,e.jsx(T,{sx:{overflow:"hidden",height:r.value?1:0,transition:s=>s.transitions.create(["height"],{duration:s.transitions.duration.shorter})},children:n})]})}be.propTypes={attachments:x.array};const B=240;function ye({participants:t,conversation:r}){const o=te(),a=H("up","lg"),{collapseDesktop:n,onCloseDesktop:s,onCollapseDesktop:i,openMobile:l,onOpenMobile:m,onCloseMobile:d}=de();c.useEffect(()=>{a||s()},[s,a]);const u=c.useCallback(()=>{a?i():m()},[a]),b=t.length>1,f=Ge(As(r.messages.map(v=>v.attachments))),j=e.jsxs(e.Fragment,{children:[b?e.jsx(fe,{participants:t}):e.jsx(je,{participant:t[0]}),e.jsx(be,{attachments:f})]}),y=e.jsx(g,{onClick:u,sx:{top:12,right:0,zIndex:9,width:32,height:32,borderRight:0,position:"absolute",borderRadius:"12px 0 0 12px",boxShadow:o.customShadows.z8,bgcolor:o.palette.background.paper,border:`solid 1px ${o.palette.divider}`,"&:hover":{bgcolor:o.palette.background.neutral},...a&&{...!n&&{right:B}}},children:a?e.jsx(h,{width:16,icon:n?"eva:arrow-ios-back-fill":"eva:arrow-ios-forward-fill"}):e.jsx(h,{width:16,icon:"eva:arrow-ios-back-fill"})});return e.jsxs(T,{sx:{position:"relative"},children:[y,a?e.jsx(p,{sx:{height:1,flexShrink:0,width:B,borderLeft:`solid 1px ${o.palette.divider}`,transition:o.transitions.create(["width"],{duration:o.transitions.duration.shorter}),...n&&{width:0}},children:!n&&j}):e.jsx(oe,{anchor:"right",open:l,onClose:d,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:B}},children:j})]})}ye.propTypes={conversation:x.object,participants:x.array};function ve({message:t,participants:r,onOpenLightbox:o}){const{user:a}=P(),{me:n,senderDetails:s,hasImage:i}=us({message:t,participants:r,currentUserId:`${a==null?void 0:a.id}`}),{firstName:l,avatarUrl:m}=s,{body:d,createdAt:u}=t,b=e.jsxs(w,{noWrap:!0,variant:"caption",sx:{mb:1,color:"text.disabled",...!n&&{mr:"auto"}},children:[!n&&`${l},`,"  ",re(new Date(u),{addSuffix:!0})]}),f=e.jsx(p,{sx:{p:1.5,minWidth:48,maxWidth:320,borderRadius:1,typography:"body2",bgcolor:"background.neutral",...n&&{color:"grey.800",bgcolor:"primary.lighter"},...i&&{p:0,bgcolor:"transparent"}},children:i?e.jsx(T,{component:"img",alt:"attachment",src:d,onClick:()=>o(d),sx:{minHeight:220,borderRadius:1.5,cursor:"pointer","&:hover":{opacity:.9}}}):d}),j=e.jsxs(p,{direction:"row",className:"message-actions",sx:{pt:.5,opacity:0,top:"100%",left:0,position:"absolute",transition:y=>y.transitions.create(["opacity"],{duration:y.transitions.duration.shorter}),...n&&{left:"unset",right:0}},children:[e.jsx(g,{size:"small",children:e.jsx(h,{icon:"solar:reply-bold",width:16})}),e.jsx(g,{size:"small",children:e.jsx(h,{icon:"eva:smiling-face-fill",width:16})}),e.jsx(g,{size:"small",children:e.jsx(h,{icon:"solar:trash-bin-trash-bold",width:16})})]});return e.jsxs(p,{direction:"row",justifyContent:n?"flex-end":"unset",sx:{mb:5},children:[!n&&e.jsx(k,{alt:l,src:m,sx:{width:32,height:32,mr:2}}),e.jsxs(p,{alignItems:"flex-end",children:[b,e.jsxs(p,{direction:"row",alignItems:"center",sx:{position:"relative","&:hover":{"& .message-actions":{opacity:1}}},children:[f,j]})]})]})}ve.propTypes={message:x.object,onOpenLightbox:x.func,participants:x.array};function Ce({messages:t=[],participants:r}){const{messagesEndRef:o}=gs(t),a=t.filter(s=>s.contentType==="image").map(s=>({src:s.body})),n=ns(a);return e.jsxs(e.Fragment,{children:[e.jsx(z,{ref:o,sx:{px:3,py:5,height:1},children:e.jsx(T,{children:t.map(s=>e.jsx(ve,{message:s,participants:r,onOpenLightbox:()=>n.onOpen(s.body)},s.id))})}),e.jsx(rs,{index:n.selected,slides:a,open:n.open,close:n.onClose})]})}Ce.propTypes={messages:x.array,participants:x.array};function we({recipients:t,onAddRecipients:r,disabled:o,selectedConversationId:a}){const n=E(),{user:s}=P(),i=c.useRef(null),[l,m]=c.useState(""),d=c.useMemo(()=>({id:`${s==null?void 0:s.id}`,role:`${s==null?void 0:s.role}`,email:`${s==null?void 0:s.email}`,address:`${s==null?void 0:s.address}`,name:`${s==null?void 0:s.displayName}`,lastActivity:new Date,avatarUrl:`${s==null?void 0:s.photoURL}`,phoneNumber:`${s==null?void 0:s.phoneNumber}`,status:"online"}),[s]),u=c.useMemo(()=>({id:X(),attachments:[],body:l,contentType:"text",createdAt:We(new Date,{minutes:1}),senderId:d.id}),[l,d.id]),b=c.useMemo(()=>({id:X(),messages:[u],participants:[...t,d],type:t.length>1?"GROUP":"ONE_TO_ONE",unreadCount:0}),[u,d,t]),f=c.useCallback(()=>{i.current&&i.current.click()},[]),j=c.useCallback(v=>{m(v.target.value)},[]),y=c.useCallback(async v=>{try{if(v.key==="Enter"){if(l)if(a)await hs(a,u);else{const I=await ps(b);n.push(`${F.dashboard.chat}?id=${I.conversation.id}`),r([])}m("")}}catch(I){console.error(I)}},[b,l,u,r,n,a]);return e.jsxs(e.Fragment,{children:[e.jsx(ie,{value:l,onKeyUp:y,onChange:j,placeholder:"Type a message",disabled:o,startAdornment:e.jsx(g,{children:e.jsx(h,{icon:"eva:smiling-face-fill"})}),endAdornment:e.jsxs(p,{direction:"row",sx:{flexShrink:0},children:[e.jsx(g,{onClick:f,children:e.jsx(h,{icon:"solar:gallery-add-bold"})}),e.jsx(g,{onClick:f,children:e.jsx(h,{icon:"eva:attach-2-fill"})}),e.jsx(g,{children:e.jsx(h,{icon:"solar:microphone-bold"})})]}),sx:{px:1,height:56,flexShrink:0,borderTop:v=>`solid 1px ${v.palette.divider}`}}),e.jsx("input",{type:"file",ref:i,style:{display:"none"}})]})}we.propTypes={disabled:x.bool,onAddRecipients:x.func,recipients:x.array,selectedConversationId:x.string};function ke({participants:t}){const r=t.length>1,o=t[0],a=e.jsx(ae,{max:3,sx:{[`& .${Ve.avatar}`]:{width:32,height:32}},children:t.map(s=>e.jsx(k,{alt:s.name,src:s.avatarUrl},s.id))}),n=e.jsxs(p,{flexGrow:1,direction:"row",alignItems:"center",spacing:2,children:[e.jsx(L,{variant:o.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(k,{src:o.avatarUrl,alt:o.name})}),e.jsx(M,{primary:o.name,secondary:o.status==="offline"?ts(o.lastActivity):o.status,secondaryTypographyProps:{component:"span",...o.status!=="offline"&&{textTransform:"capitalize"}}})]});return e.jsxs(e.Fragment,{children:[r?a:n,e.jsx(p,{flexGrow:1}),e.jsx(g,{children:e.jsx(h,{icon:"solar:phone-bold"})}),e.jsx(g,{children:e.jsx(h,{icon:"solar:videocamera-record-bold"})}),e.jsx(g,{children:e.jsx(h,{icon:"eva:more-vertical-fill"})})]})}ke.propTypes={participants:x.array};function Se({contacts:t,onAddRecipients:r}){const[o,a]=c.useState(""),n=c.useCallback(s=>{a(""),r(s)},[r]);return e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"subtitle2",sx:{color:"text.primary",mr:2},children:"To:"}),e.jsx(as,{sx:{minWidth:320},multiple:!0,limitTags:3,popupIcon:null,defaultValue:[],disableCloseOnSelect:!0,noOptionsText:e.jsx(le,{query:o}),onChange:(s,i)=>n(i),onInputChange:(s,i)=>a(i),options:t,getOptionLabel:s=>s.name,isOptionEqualToValue:(s,i)=>s.id===i.id,renderInput:s=>e.jsx(ce,{...s,placeholder:"+ Recipients"}),renderOption:(s,i,{selected:l})=>c.createElement("li",{...s,key:i.id},e.jsxs(T,{sx:{mr:1,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[e.jsx(k,{alt:i.name,src:i.avatarUrl,sx:{width:1,height:1}}),e.jsx(p,{alignItems:"center",justifyContent:"center",sx:{top:0,left:0,width:1,height:1,opacity:0,position:"absolute",bgcolor:m=>R(m.palette.grey[900],.8),transition:m=>m.transitions.create(["opacity"],{easing:m.transitions.easing.easeInOut,duration:m.transitions.duration.shorter}),...l&&{opacity:1,color:"primary.main"}},children:e.jsx(h,{icon:"eva:checkmark-fill"})})]},i.id),i.name),renderTags:(s,i)=>s.map((l,m)=>c.createElement(is,{...i({index:m}),key:l.id,label:l.name,avatar:e.jsx(k,{alt:l.name,src:l.avatarUrl}),size:"small",variant:"soft"}))})]})}Se.propTypes={contacts:x.array,onAddRecipients:x.func};function Os(){const t=E(),{user:r}=P(),o=_e(),n=Be().get("id")||"",[s,i]=c.useState([]),{contacts:l}=ls(),{conversations:m,conversationsLoading:d}=cs(),{conversation:u,conversationError:b}=ds(`${n}`),f=u?u.participants.filter(S=>S.id!==`${r.id}`):[];c.useEffect(()=>{(b||!n)&&t.push(F.dashboard.chat)},[b,t,n]);const j=c.useCallback(S=>{i(S)},[]),y=!!u,v=e.jsx(p,{direction:"row",alignItems:"center",flexShrink:0,sx:{pr:1,pl:2.5,py:1,minHeight:72},children:n?e.jsx(e.Fragment,{children:y&&e.jsx(ke,{participants:f})}):e.jsx(Se,{contacts:l,onAddRecipients:j})}),I=e.jsx(ue,{contacts:l,conversations:m,loading:d,selectedConversationId:n}),N=e.jsxs(p,{sx:{width:1,height:1,overflow:"hidden"},children:[e.jsx(Ce,{messages:u==null?void 0:u.messages,participants:f}),e.jsx(we,{recipients:s,onAddRecipients:j,selectedConversationId:n,disabled:!s.length&&!n})]});return e.jsxs(qe,{maxWidth:o.themeStretch?!1:"xl",children:[e.jsx(w,{variant:"h4",sx:{mb:{xs:3,md:5}},children:"Chat"}),e.jsxs(p,{component:He,direction:"row",sx:{height:"72vh"},children:[I,e.jsxs(p,{sx:{width:1,height:1,overflow:"hidden"},children:[v,e.jsxs(p,{direction:"row",sx:{width:1,height:1,overflow:"hidden",borderTop:S=>`solid 1px ${S.palette.divider}`},children:[N,y&&e.jsx(ye,{conversation:u,participants:f})]})]})]})]})}function dt(){return e.jsxs(e.Fragment,{children:[e.jsx(Je,{children:e.jsx("title",{children:" Dashboard: Chat"})}),e.jsx(Os,{})]})}export{dt as default};
